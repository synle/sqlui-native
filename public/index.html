<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="SQLUI Native - A minimal Electron application for Databases" />
    <script type="text/javascript">
      // Suppress benign ResizeObserver loop errors before CRA overlay loads
      var _origOnerror = window.onerror;
      window.onerror = function(msg) {
        if (typeof msg === 'string' && msg.indexOf('ResizeObserver loop') > -1) return true;
        return _origOnerror ? _origOnerror.apply(this, arguments) : false;
      };
      window.addEventListener('error', function(e) {
        if (e.message && e.message.indexOf('ResizeObserver loop') > -1) {
          e.stopImmediatePropagation();
          e.stopPropagation();
          e.preventDefault();
        }
      }, true);
    </script>
    <script type="text/javascript">
      window.requireElectron = window.require; // keep an existing copy of electron require

      window.addEventListener('sqluiNativeEvent/init', function () {
        const vsCodeLoader = '%PUBLIC_URL%/vs/loader.js';
        let amdRequire;
        let amdDefine;

        function _loadjs(file, cb) {
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = file;
          script.onload = cb;
          document.body.appendChild(script);
        }

        new Promise((resolve) => {
          // Hide Node.js module system so Monaco loader uses browser code paths
          // instead of Node's vm module (which is deprecated in Electron renderer)
          self.module = undefined;

          try {
            // Electron mode: compute file:// base URL for Monaco assets
            var path = requireElectron('path');

            function _uriFromPath(_path) {
              var pathName = path.resolve(_path).replace(/\\/g, '/');
              if (pathName.length > 0 && pathName.charAt(0) !== '/') {
                pathName = '/' + pathName;
              }
              return encodeURI('file://' + pathName);
            }

            var monacoBaseUrl = _uriFromPath(path.join(__dirname, '%PUBLIC_URL%'));

            _loadjs(vsCodeLoader, function () {
              amdRequire = window.require;
              amdDefine = window.require.define;

              amdRequire.config({
                baseUrl: monacoBaseUrl,
              });

              resolve();
            });
          } catch (err) {
            // Mocked web server mode: load via script tag with default paths
            _loadjs(vsCodeLoader, function () {
              amdRequire = window.require;
              resolve();
            });
          }
        }).then(function () {
          amdRequire(['vs/editor/editor.main'], function () {
            window.monaco = monaco;

            window.dispatchEvent(new Event('sqluiNativeEvent/ready'));
          });
        });
      });
    </script>
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo512.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Loading...</title>
  </head>
  <body>
    <div id="body">Loading...</div>
  </body>
</html>
