<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}">
  <head>
    <meta charset="UTF-8">
    {% seo %}
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" href="public/favicon.ico" />
    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    {% include head-custom.html %}
  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">
        <a href="https://synle.github.io/sqlui-native/" style="color: white">
          {{ page.title | default: site.title | default: site.github.repository_name }} (<span class='appVersion'>...</span>)
        </a>
      </h1>
      <h2 class="project-tagline">{{ page.description | default: site.description | default: site.github.project_tagline }}</h2>

      {% if site.github.is_project_page %}
        <a href="{{ site.github.repository_url }}" class="btn">GitHub</a>
      {% endif %}

      <div id="download-buttons-container" style="display: inline;"></div>

      <a id="btn-other-releases" href="#" class="btn">Other Releases</a>

      <p style="margin-top: 10px; font-size: 0.85em; opacity: 0.9;">
        <i class="fas fa-info-circle" style="margin-right: 5px;"></i>
        <b>macOS Apple Silicon (M-Series) users:</b> If you see an "app is damaged" error, run <code>xattr -cr /Applications/sqlui-native.app</code> in Terminal to fix it.
      </p>
    </header>

    <main id="content" class="main-content" role="main">
      {{ content }}

      <footer class="site-footer">
        {% if site.github.is_project_page %}
          <span class="site-footer-owner">
            <a href="{{ site.github.repository_url }}">{{ site.github.repository_name }}</a> is developed and maintained by
            <b>Sy Le</b>
            (
              <a href="https://www.linkedin.com/in/syle1021/">linkedin profile</a>
              <span style="margin-inline: 5px">/</span>
              <a href="https://github.com/synle">github</a>
            )
          .</span>
        {% endif %}
      </footer>
    </main>

    <script>
      (async () => {
        const DOWNLOADS_CONFIG = [
          { id: 'download-link-mac-arm64', suffix: '-arm64.dmg', label: 'macOS Apple Silicon M-Series (<b>.dmg</b>)' },
          { id: 'download-link-mac-x64', suffix: '-x64.dmg', label: 'macOS Intel x64 (<b>.dmg</b>)' },
          { id: 'download-link-windows-x64', suffix: '-x64.exe', label: 'Windows x64 - AMD / Intel (<b>.exe</b>)' },
          { id: 'download-link-windows-arm64', suffix: '-arm64.exe', label: 'Windows ARM64 (<b>.exe</b>)' },
          { id: 'download-link-ubuntu', suffix: '.deb', label: 'Ubuntu - Debian (<b>.deb</b>)' },
          { id: 'download-link-appimage', suffix: '.AppImage', label: 'Linux (<b>.AppImage</b>)' }
        ];

        try {
          const response = await fetch('https://synle.github.io/sqlui-native/release.json');
          const { version } = await response.json();

          // 1. Update Version in Title and "Other Releases" link
          document.querySelectorAll('.appVersion').forEach(el => el.innerText = version);
          document.getElementById('btn-other-releases').href = `https://github.com/synle/sqlui-native/releases/tag/${version}`;

          // 2. Generate Download Buttons
          const container = document.getElementById('download-buttons-container');
          const baseUrl = `https://github.com/synle/sqlui-native/releases/download/${version}/sqlui-native-${version}`;

          container.innerHTML = DOWNLOADS_CONFIG.map(cfg => `
            <a id="${cfg.id}" href="${baseUrl}${cfg.suffix}" class="btn">
              <i class="fas fa-download" style="margin-right: 5px;"></i> ${cfg.label}
            </a>
          `).join('');

          // 3. Update instructions/links in the main content (<li> items)
          document.querySelectorAll('li').forEach(li => {
            if (!li.innerText.includes('%')) return;

            const matchedCfg = DOWNLOADS_CONFIG.find(cfg => li.innerText.includes(cfg.id));
            if (matchedCfg) {
              const cleanLabel = matchedCfg.label.replace(/<\/?[^>]+(>|$)/g, ""); // strip <b> tags for the list link
              li.innerHTML = `<a href="${baseUrl}${matchedCfg.suffix}">${cleanLabel}</a>`;
            }
          });

        } catch (err) {
          console.error('Failed to initialize download links:', err);
        }
      })();
    </script>
  </body>
</html>
